<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<!--header-->
<header th:replace="~{fragments/header :: header}"></header>


<!--게시글 상세 정보-->
<h1> 게시글 상세 정보 </h1>
<div class="post-information">

    <!--게시글 정보-->
    <h1 th:text="${postInfo.title}">게시글 제목</h1>

    <!--로그인한 사용자에게만 보임-->
    <div sec:authorize="isAuthenticated()">
        <a th:href="@{/post/new}"> 게시글 작성 </a>

        <!--"작성자 == 로그인된 사용자" 일 경우 보임-->
        <a th:if="${postInfo.username} == ${#authentication.name}"
           th:href="@{'/post/' + ${postInfo.postId} + '/update'}"> 게시글 수정 </a>

        <!--"작성자 == 로그인된 사용자" 일 경우 보임-->
        <button th:if="${postInfo.username} == ${#authentication.name}"
                class="delete-post"
                th:data-id="${postInfo.postId}"
                onclick="deletePost(this.getAttribute('data-id'))">게시글 삭제</button>
    </div>


    <textarea th:text="${postInfo.content}" readonly style="width: 100%; height: 200px;">게시글 내용</textarea>


    <div>
        <label>작성자 : </label>
        <span th:text="${postInfo.member}">작성자</span>
    </div>
    <div>
        <label>조회수 : </label>
        <span th:text="${postInfo.view}">조회수</span>
    </div>
    <div>
        <label>작성일자 : </label>
        <span th:text="${postInfo.createdAt}">작성일자</span>
    </div>
    <div>
        <label>수정일자 : </label>
        <span th:text="${postInfo.updatedAt}">수정일자</span>
    </div>

</div>


<!--댓글 목록-->
<h1> 댓글 목록 </h1>



<!--footer-->
<div th:replace="~{fragments/footer :: footer}"></div>



<script th:inline="javascript">
    /* 삭제 기능 수행 */
    function deletePost(postId) {
        fetch('/api/posts/' + postId, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
            }
        }).then(response => {
            if (!response.ok) {
                throw new Error('네트워크 응답이 실패했습니다.');
            }
            return response.text(); // 응답을 텍스트로 처리
        }).then(message => {
            alert(message); // 서버로부터 받은 메시지를 직접 출력
            window.location.href = '/';
        }).catch(error => {
            console.error('게시글 삭제 중 오류 발생:', error);
            alert('게시글 삭제 중 오류 발생: ' + error.message); // 오류 메시지를 더 명확하게 표시
        });
    }

</script>

</body>
</html>